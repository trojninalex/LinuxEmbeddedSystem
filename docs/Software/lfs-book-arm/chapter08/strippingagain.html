<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content=
    "application/xhtml+xml; charset=iso-8859-1" />
    <title>
      8.78.&nbsp;Stripping Again
    </title>
    <link rel="stylesheet" type="text/css" href="../stylesheets/lfs.css" />
    <meta name="generator" content="DocBook XSL Stylesheets Vsnapshot" />
    <link rel="stylesheet" href="../stylesheets/lfs-print.css" type=
    "text/css" media="print" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  </head>
  <body class="lfs" id="lfs-ca9c-sysv">
    <div class="navheader">
      <h4>
        Linux From Scratch - Version ca9c-sysv
      </h4>
      <h3>
        Chapter&nbsp;8.&nbsp;Installing Basic System Software
      </h3>
      <ul>
        <li class="prev">
          <a accesskey="p" href="aboutdebug.html" title=
          "About Debugging Symbols">Prev</a>
          <p>
            About Debugging Symbols
          </p>
        </li>
        <li class="next">
          <a accesskey="n" href="revisedchroot.html" title=
          "Cleaning Up">Next</a>
          <p>
            Cleaning Up
          </p>
        </li>
        <li class="up">
          <a accesskey="u" href="chapter08.html" title=
          "Chapter&nbsp;8.&nbsp;Installing Basic System Software">Up</a>
        </li>
        <li class="home">
          <a accesskey="h" href="../index.html" title=
          "Linux From Scratch - Version ca9c-sysv ">Home</a>
        </li>
      </ul>
    </div>
    <div class="sect1" lang="en" xml:lang="en">
      <h1 class="sect1">
        <a id="ch-system-strippingagain" name=
        "ch-system-strippingagain"></a>8.78. Stripping Again
      </h1>
      <p>
        This section is optional. If the intended user is not a programmer
        and does not plan to do any debugging on the system software, the
        system size can be decreased by about 2 GB by removing the debugging
        symbols from binaries and libraries. This causes no inconvenience
        other than not being able to debug the software fully anymore.
      </p>
      <p>
        Most people who use the commands mentioned below do not experience
        any difficulties. However, it is easy to make a typo and render the
        new system unusable, so before running the <span class=
        "command"><strong>strip</strong></span> commands, it is a good idea
        to make a backup of the LFS system in its current state.
      </p>
      <p>
        First place the debugging symbols for selected libraries in separate
        files. This debugging information is needed if running regression
        tests that use <a class="ulink" href=
        "https://www.linuxfromscratch.org/blfs/view/svn//general/valgrind.html">
        valgrind</a> or <a class="ulink" href=
        "https://www.linuxfromscratch.org/blfs/view/svn//general/gdb.html">gdb</a>
        later in BLFS.
      </p>
      <pre class="userinput"><kbd class=
      "command">save_usrlib="ld-2.33.so libc-2.33.so libpthread-2.33.so libthread_db-1.0.so
             libstdc++.so.6.0.29
             libitm.so.1.0.0 libatomic.so.1.2.0" 

cd /usr/lib

for LIB in $save_usrlib; do
    objcopy --only-keep-debug $LIB $LIB.dbg
    strip --strip-unneeded $LIB
    objcopy --add-gnu-debuglink=$LIB.dbg $LIB
done

unset LIB save_usrlib</kbd></pre>
      <p>
        Now the binaries and libraries can be stripped:
      </p>
      <pre class="userinput"><kbd class=
      "command">find /usr/lib -type f -name \*.a \
   -exec strip --strip-debug {} ';'

find /usr/lib -type f -name \*.so* ! -name \*dbg \
   -exec strip --strip-unneeded {} ';'

find /usr/{bin,sbin,libexec} -type f \
    -exec strip --strip-all {} ';'</kbd></pre>
      <p>
        A large number of files will be reported as having their file format
        not recognized. These warnings can be safely ignored. These warnings
        indicate that those files are scripts instead of binaries.
      </p>
    </div>
    <div class="navfooter">
      <ul>
        <li class="prev">
          <a accesskey="p" href="aboutdebug.html" title=
          "About Debugging Symbols">Prev</a>
          <p>
            About Debugging Symbols
          </p>
        </li>
        <li class="next">
          <a accesskey="n" href="revisedchroot.html" title=
          "Cleaning Up">Next</a>
          <p>
            Cleaning Up
          </p>
        </li>
        <li class="up">
          <a accesskey="u" href="chapter08.html" title=
          "Chapter&nbsp;8.&nbsp;Installing Basic System Software">Up</a>
        </li>
        <li class="home">
          <a accesskey="h" href="../index.html" title=
          "Linux From Scratch - Version ca9c-sysv ">Home</a>
        </li>
      </ul>
    </div>
  </body>
</html>
